name: handoff
version: 1.0
created: 2025-01-11

intent: |
  Context is the most expensive thing in development.

  When you stop working and someone else starts, there's a brutal context
  switch. The new person has to reconstruct: What were you doing? Why?
  What's the current state? What did you try that didn't work? What should
  happen next?

  Without handoff, this reconstruction takes 30+ minutes of archaeology
  through git logs, chat history, and file diffs. With handoff, it takes
  30 seconds of reading a structured summary.

  The handoff tool captures context at transition points - end of day,
  switching between AI and human, between team members. It aggregates
  information that already exists (git, journal, environment) and adds
  structured space for human insight (blockers, next steps, open questions).

  Key insight: The best handoff happens before you forget. Capture context
  while it's fresh, not when someone asks for it later.

  This is equally valuable for human-to-human, human-to-AI, and AI-to-human
  transitions. Agents lose context on session boundaries just like humans do.

constraints:
  - Must work without network access
  - Handoff creation should take < 30 seconds (time to forget context)
  - Auto-aggregated data must not require manual intervention
  - Output must be human-readable (not JSON-first)
  - Must integrate with existing journal/git rather than duplicate
  - Handoffs stored locally, not shipped to external service
  - Should prompt for human additions, not require them

interface:
  commands:
    create:
      args: "[NAME] [--to NAME] [--hours N] [--verbose]"
      returns: "Creates handoff document, opens for editing"
      example: "handoff create end-of-day"

    receive:
      args: "[NAME]"
      returns: "Displays handoff with formatting"
      example: "handoff receive end-of-day"

    list:
      args: "(none)"
      returns: "Shows available handoffs with metadata"
      example: "handoff list"

    status:
      args: "[--hours N]"
      returns: "Quick status summary without creating handoff"
      example: "handoff status"

  exit_codes:
    0: success
    1: handoff not found or creation failed
    2: configuration error

examples:
  - scenario: "Developer ending work day"
    context: "5pm, been debugging auth issue all day, not solved yet"
    action: "handoff create end-of-day"
    result: "Document with git activity, active loops, space for 'where I left off'"
    why_it_matters: "Tomorrow-you (or teammate) knows exactly where to resume"

  - scenario: "AI agent completing task, needs human review"
    context: "Agent implemented feature, wants human to take over for polish"
    action: "handoff create --to human 'feature complete, needs review'"
    result: "Summary of what was done, what files changed, what to check"
    why_it_matters: "Human reviewer has context without reading all code changes"

  - scenario: "Human returning from lunch, AI was working"
    context: "Left AI running on bug, came back to lots of changes"
    action: "handoff receive"
    result: "See what AI did, what succeeded, what failed, current state"
    why_it_matters: "Jump back in without 'wait, what happened while I was gone?'"

  - scenario: "Shift change between team members"
    context: "Alice is done for the day, Bob is taking over the oncall"
    action: "Alice: handoff create --to bob; Bob: handoff receive"
    result: "Bob sees: what's in flight, known issues, what Alice tried"
    why_it_matters: "Continuity without synchronous meeting"

  - scenario: "Quick status check"
    context: "Manager wants to know what's happening without full handoff"
    action: "handoff status"
    result: "One-screen summary: branch, recent commits, active processes"
    why_it_matters: "Visibility without ceremony"

decisions:
  - choice: "Markdown format with structured sections over free-form"
    why: |
      Structure ensures completeness. When you're tired at end of day, you'll
      forget to mention blockers unless there's a section prompting for it.

      The template has:
      - Current Task (what you're doing)
      - Blockers & Issues (what's stuck)
      - Next Steps (what should happen)
      - Open Questions (what's uncertain)
      - Important Context (anything else)

      Each section prompts you to think about that aspect. Free-form notes
      would skip important categories.
    alternatives:
      - option: "Free-form text"
        rejected_because: "Easy to forget categories, inconsistent structure, harder to scan"
      - option: "JSON schema"
        rejected_because: "Not human-friendly to write or read"
      - option: "Interactive questionnaire"
        rejected_because: "Too slow, feels like a chore, people skip it"

  - choice: "Auto-aggregate from journal and git before asking for input"
    why: |
      Start with what we already know. The tool should pre-populate:
      - Recent commits
      - Journal events
      - Current branch/status
      - Active loops/agents

      Then ask humans to add what machines can't know:
      - Why decisions were made
      - What approaches didn't work
      - What feels risky

      This respects human time - only ask for novel information.
    alternatives:
      - option: "Require all manual input"
        rejected_because: "Tedious, duplicates existing data, people skip it"
      - option: "Fully automated (no human input)"
        rejected_because: "Misses crucial context that isn't in logs"

  - choice: "Default to 8 hours of history"
    why: |
      A work day's worth of context is the right scope for most handoffs.
      Too little misses relevant history; too much is noise.

      Configurable with --hours for shift work or longer sessions.
    alternatives:
      - option: "All history since last handoff"
        rejected_because: "Could be days or minutes, unpredictable scope"
      - option: "Since start of day (midnight)"
        rejected_because: "Doesn't match work patterns, misses previous evening"

  - choice: "Store as .md files, one per handoff"
    why: |
      Simple file format means:
      - Editable with any editor
      - Readable without special tools
      - Easy to share (email, paste, commit)
      - Searchable with grep

      Timestamps in filenames for sorting. No database needed.
    alternatives:
      - option: "SQLite database"
        rejected_because: "Overkill, harder to edit, not portable"
      - option: "Single file with all handoffs"
        rejected_because: "Grows unbounded, hard to manage"

  - choice: "Open editor immediately after creation"
    why: |
      Strike while the iron is hot. Context is freshest right after the
      template is generated. If we just save the file and exit, people
      won't go back to fill it in.

      Interactive prompt "Open for editing? [Y/n]" with default yes.
    alternatives:
      - option: "Just save, user edits later"
        rejected_because: "Loses context, people forget to edit"
      - option: "Require all input via CLI flags"
        rejected_because: "Clumsy for multi-line content"

anti_patterns:
  - pattern: "Making handoff creation take more than a minute"
    why_bad: |
      If it's slow, people won't do it. End of day, people want to leave.
      The tool must feel instant - auto-aggregation should handle most
      content, human adds just the critical context.

  - pattern: "Requiring handoffs (mandatory process)"
    why_bad: |
      Resentment builds. Handoffs should be valuable enough that people
      want to create them. If you have to mandate it, the tool has failed.

  - pattern: "Syncing handoffs to cloud/Slack automatically"
    why_bad: |
      Handoffs may contain sensitive context (what's broken, security issues).
      Keep them local by default. Sharing is explicit action by the creator.

  - pattern: "Overloading with too many sections"
    why_bad: |
      Decision fatigue. Five sections is the limit. Each additional section
      adds friction and reduces completion rate. The template should be
      scannable in 10 seconds.

  - pattern: "Using handoffs for permanent documentation"
    why_bad: |
      Handoffs are ephemeral context - relevant now, stale tomorrow.
      Don't conflate with documentation (which should live in docs/).
      Handoffs can reference docs, not replace them.

  - pattern: "AI writing the entire handoff without human review"
    why_bad: |
      AI-generated summaries miss nuance. The human knows what's actually
      important, what's misleading in the logs, what context matters.
      Auto-aggregation assists; human insight completes.

connects_to:
  - component: journal
    relationship: |
      Primary data source for "what happened."
      handoff reads recent journal events to populate activity section.
      After handoff creation, logs the handoff event itself.

  - component: git
    relationship: |
      Extracts recent commits, current branch, uncommitted changes.
      Provides objective timeline of code changes.

  - component: loop
    relationship: |
      Shows active loops and their status.
      "Currently running: loop 'fix tests' - iteration 4"
      Helps recipient understand ongoing processes.

  - component: agent
    relationship: |
      Shows active agents and their tasks.
      AI-to-human handoffs are especially important - agent explains
      what it did and why before human takes over.

  - component: session
    relationship: |
      Can restore environment from handoff context.
      "This handoff was created in project X with these env vars"

  - component: notify
    relationship: |
      Can notify recipient when handoff is created for them.
      "handoff create --to bob" triggers notification to bob.

metrics:
  success_criteria:
    - "Handoff creation completes in < 30 seconds"
    - "Recipients find handoffs genuinely useful (not just ceremony)"
    - "Time to context recovery < 2 minutes with handoff vs 30+ without"
    - "Team members voluntarily create handoffs"
    - "AI-to-human transitions feel smooth"

  failure_indicators:
    - "Handoffs are created but never read"
    - "People skip handoff because it takes too long"
    - "Handoffs contain only auto-generated content (no human insight)"
    - "Recipients still ask 'what were you working on?' after receiving handoff"
    - "Handoffs become stale documentation instead of ephemeral context"
