name: focus
version: 1.0
created: 2025-01-11

intent: |
  Protect the sacred space of deep work.

  The focus tool exists because modern development is an attention war. Notifications,
  Slack messages, Twitter, email - all compete for the finite resource of concentrated
  thought. Code quality correlates directly with focus duration. A 90-minute deep work
  session produces better architecture than four scattered 20-minute windows.

  The Pomodoro Technique (25 min work / 5 min break) is proven but rigid. Some problems
  need 90 minutes of unbroken concentration. Others need quick 15-minute sprints.
  Focus provides the timer, but more importantly, it provides the COMMITMENT. Starting
  a focus session is a contract with yourself: "For the next N minutes, I do this one thing."

  The deeper insight: focus is about BOUNDARIES, not willpower. Blocking distractions
  removes the need for discipline. The break reminders prevent burnout before it happens.
  Statistics reveal patterns you didn't notice (you're always unfocused on Mondays).

  Human productivity is not about working more hours. It's about protecting the quality
  of the hours you work.

constraints:
  - Session state persists across terminal sessions: Track active focus in file system
  - Background timer runs independently: Don't require terminal to stay open
  - Cross-platform notifications: Support macOS/Linux notification systems
  - No external services: All data local, works offline
  - Integrates with journal: All focus events logged for metrics
  - Integrates with notify: Desktop alerts for session start/end
  - Non-blocking CLI: Commands return immediately (timers in background)
  - Graceful degradation: Work without optional integrations (notify, journal)

interface:
  commands:
    start:
      args: "[MINS] [--pomodoro|--deep|--quick] [--task \"DESC\"] [--block] [--notify]"
      returns: "Confirmation with session details and end time"
      example: "focus start 45 --task \"Implement auth\""

    stop:
      args: ""
      returns: "Session summary with completion percentage"
      example: "focus stop"

    status:
      args: ""
      returns: "Progress bar, elapsed/remaining time, task description"
      example: "focus status"

    break:
      args: "[MINS]"
      returns: "Break timer with suggestions for break activities"
      example: "focus break 10"

    stats:
      args: "[DAYS]"
      returns: "Focus statistics over time period"
      example: "focus stats 30"

    block:
      args: "[--quiet]"
      returns: "Enables distraction blocking (placeholder for OS integration)"
      example: "focus block"

    unblock:
      args: "[--quiet]"
      returns: "Disables distraction blocking"
      example: "focus unblock"

  exit_codes:
    0: "Command succeeded"
    1: "Session already active (start) or no active session (stop)"
    2: "Invalid arguments"

  presets:
    pomodoro:
      focus: 25
      break: 5
      philosophy: "Sustainable rhythm, good for maintenance work"
    deep:
      focus: 90
      break: 20
      philosophy: "Maximum depth, for complex problems"
    quick:
      focus: 15
      break: 3
      philosophy: "Fast iteration, for small tasks"

examples:
  - scenario: "Starting a deep work session"
    context: "Developer tackling complex architectural refactor"
    action: "focus start --deep --task \"Refactor auth system\""
    result: "90-minute timer starts, notification scheduled, logged to journal"
    why_it_matters: |
      The commitment is explicit. You've told yourself AND the system what you're
      doing for the next 90 minutes. No ambiguity, no escape hatch. The notification
      at the end means you don't need to clock-watch.

  - scenario: "Quick status check"
    context: "Mid-session, wondering how much time left"
    action: "focus status"
    result: "Progress bar shows 65% complete, 12 minutes remaining"
    why_it_matters: |
      Glanceable progress. You know where you are without breaking flow.
      The progress bar is satisfying - it rewards sustained attention.

  - scenario: "Interrupted and need to stop early"
    context: "Emergency meeting called, must abandon session"
    action: "focus stop"
    result: "Partial session recorded (38 of 45 minutes), task marked incomplete"
    why_it_matters: |
      Reality happens. Partial sessions still count toward stats.
      Knowing your completion rate reveals interrupt patterns.

  - scenario: "Reviewing productivity patterns"
    context: "Weekend reflection on the work week"
    action: "focus stats 7"
    result: "Shows sessions per day, completion rate, total focus hours"
    why_it_matters: |
      Data over intuition. Maybe you THINK you focused 6 hours Thursday,
      but the stats show 2 hours of actual tracked focus. Truth is useful.

  - scenario: "Pairing focus with loop"
    context: "Fixing a bug that might take multiple attempts"
    action: "focus start 45 --task \"Fix test flakiness\" && loop start \"fix tests\" --promise pytest"
    result: "Protected 45-minute window for iterative debugging"
    why_it_matters: |
      Focus protects the time, loop handles the iteration. The combination
      ensures you both HAVE time and USE it effectively.

decisions:
  - choice: "Background timer process instead of blocking foreground"
    why: |
      Focus sessions can be 90 minutes. Nobody keeps a terminal open that long
      for a timer. The timer must survive terminal closure, shell restarts,
      even SSH disconnections.

      We spawn a background process that sleeps then notifies. The session
      state is stored in a file, so any terminal can check status or stop.
    alternatives:
      - option: "Foreground blocking timer (like sleep)"
        rejected_because: "Can't close terminal, can't use it for work"
      - option: "Systemd timer / launchd job"
        rejected_because: "Too complex for a focus timer, varies by OS"
      - option: "External daemon process"
        rejected_because: "Overkill - simple background job suffices"

  - choice: "Presets (pomodoro/deep/quick) rather than only custom times"
    why: |
      Decision fatigue is real. "How long should I focus?" is a question
      that doesn't need answering every time. The presets encode proven
      techniques:

      - Pomodoro (25/5): Research-backed, sustainable, good default
      - Deep (90/20): Maximum focus before cognitive decline
      - Quick (15/3): Timeboxed sprints for small tasks

      Custom times still supported for edge cases.
    alternatives:
      - option: "Only custom times (focus start 25)"
        rejected_because: "Requires decision every time, no guidance for users"
      - option: "Only presets, no custom"
        rejected_because: "Too rigid - sometimes 45 minutes is exactly right"

  - choice: "Record partial sessions as incomplete"
    why: |
      A 38-minute session that was supposed to be 45 minutes is valuable data.
      It still represents focused work time. But it's ALSO important to track
      that it wasn't completed - this reveals interrupt patterns.

      completed: true means you made it to the bell.
      completed: false means something interrupted you.

      Over time, your completion rate tells a story.
    alternatives:
      - option: "Don't record stopped sessions"
        rejected_because: "Loses data about actual focus time"
      - option: "Count as complete if >80% done"
        rejected_because: "Arbitrary threshold, hides interrupt patterns"

  - choice: "Distraction blocking is a placeholder, not fully implemented"
    why: |
      Real distraction blocking requires:
      - macOS: Screen Time API, /etc/hosts, or app-specific rules
      - Linux: iptables, /etc/hosts, or DE-specific tools

      This is complex, OS-specific, and potentially dangerous (breaking network).
      We provide the API and tracking, but actual blocking is a future enhancement
      that should be carefully implemented per-platform.

      The tool tracks THAT blocking should be active, even if it doesn't enforce it.
    alternatives:
      - option: "Full blocking implementation now"
        rejected_because: "Complex, risky, OS-specific - distraction from core value"
      - option: "No blocking support at all"
        rejected_because: "Blocking is valuable, worth having the API even without enforcement"

  - choice: "JSONL for session logs (one JSON object per line)"
    why: |
      Sessions accumulate over time. JSONL allows:
      - Append-only writes (no read-modify-write)
      - Easy tail/grep for recent entries
      - Simple parsing with jq or any JSON library
      - One file per day (sessions-2025-01-11.jsonl)

      Daily files prevent any single file from growing unbounded.
    alternatives:
      - option: "Single JSON file with array"
        rejected_because: "Requires loading entire history for each append"
      - option: "SQLite database"
        rejected_because: "Overkill for append-only timestamped events"

anti_patterns:
  - pattern: "Starting focus sessions without a defined task"
    why_bad: |
      "focus start 25" works, but "focus start 25 --task \"Review PR #123\"" is better.

      The task description creates accountability. Without it, you can drift.
      "I'm focusing" is vague. "I'm focusing on reviewing PR #123" is specific.

      The stats become more meaningful when you can see WHAT you focused on.

  - pattern: "Ignoring break reminders"
    why_bad: |
      The brain needs breaks. 90 minutes of focus followed by 5 minutes of
      more coding is not effective. The break is part of the technique.

      When the session ends, ACTUALLY take a break:
      - Stand up
      - Look away from screen
      - Hydrate
      - Move

      Then come back sharper.

  - pattern: "Using focus as a guilt mechanism"
    why_bad: |
      Low completion rates are DATA, not judgment. If you consistently
      stop sessions early, that's information about your environment:
      - Too many meetings?
      - Too many interrupts?
      - Sessions too long?

      Adjust the parameters, don't shame yourself into unrealistic sessions.

  - pattern: "Focus sessions during meetings or collaboration time"
    why_bad: |
      Focus mode means "do not disturb for N minutes." If you're supposed
      to be responsive (during on-call, in meetings, pair programming),
      don't start a focus session.

      Focus is for solo deep work. Collaboration has different rules.

  - pattern: "Chaining focus sessions without breaks"
    why_bad: |
      "focus start && focus start && focus start" is a recipe for burnout.

      Even if you feel productive, sustained focus without breaks:
      - Reduces creativity
      - Increases errors
      - Builds fatigue debt

      Take the breaks. They're not optional.

connects_to:
  - component: notify
    relationship: |
      Focus uses notify for session start/end alerts:
        focus start --notify → notify "Focus session started"
        (timer ends) → notify "Focus complete! Take a break"

      Desktop notifications mean you don't need to watch the terminal.
      You'll hear when it's time to stop.

  - component: journal
    relationship: |
      All focus events logged to journal:
        focus start → journal log "Focus session started: 45 min - Review PR"
        focus stop  → journal log "Focus session completed"

      Journal provides the audit trail. Metrics aggregates it.

  - component: metrics
    relationship: |
      Metrics reads focus data for productivity reports:
        metrics today → shows focus sessions and completion rate
        metrics week  → shows daily focus time chart

      Focus generates the data, metrics visualizes it.

  - component: gates
    relationship: |
      Gates can require active focus for certain operations:
        git_commit: requires_focus: true

      This enforces "commit only during focused work" policies.
      Prevents distracted, low-quality commits.

  - component: loop
    relationship: |
      Focus + loop is a powerful combination:
        focus start 45 --task "Fix auth bug"
        loop start "fix the bug" --promise "pytest tests/test_auth.py"

      Focus protects the time window.
      Loop handles the iteration within that window.

metrics:
  success_criteria:
    - "Users start focus sessions before deep work (habit formed)"
    - "Completion rate > 70% (sessions aren't too ambitious)"
    - "Break reminders actually taken (not ignored)"
    - "Stats reveal actionable patterns (not just vanity metrics)"
    - "Integration with notify/journal works seamlessly"

  failure_indicators:
    - "Users never use --task (sessions have no context)"
    - "Very low completion rate (sessions too long or too many interrupts)"
    - "Focus tool forgotten (not part of workflow)"
    - "Users work through breaks consistently"
    - "Stats ignored (data collected but not reviewed)"
