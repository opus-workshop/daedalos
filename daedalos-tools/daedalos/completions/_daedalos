#compdef daedalos

# Zsh completion for daedalos
# Place in your fpath (e.g., ~/.zsh/completions/_daedalos)

_daedalos() {
    local -a commands
    local -a core_tools
    local -a human_tools
    local -a supervision_tools
    local -a meta_commands

    core_tools=(
        'loop:Iterate until promise met - THE CORE'
        'verify:Universal lint/type/build/test runner'
        'undo:File-level undo with timeline'
        'sandbox:Ephemeral experiment environments'
        'project:Pre-computed codebase intelligence'
        'codex:Semantic code search'
        'context:Context window management'
        'error-db:Error pattern database'
        'agent:Multi-agent orchestration'
        'mcp-hub:MCP server management'
        'lsp-pool:Pre-warmed language servers'
        'scratch:Project-scoped ephemeral environments'
        'spec:Rich specifications for AI context'
        'resolve:Uncertainty resolution through context'
        'evolve:Code evolution analysis'
    )

    human_tools=(
        'env:Project environment switching'
        'notify:Desktop notifications'
        'session:Save/restore terminal sessions'
        'secrets:Local secrets vault'
        'pair:Pair programming (shared tmux)'
        'handoff:Context summaries for shift changes'
        'review:Human code review workflow'
        'focus:Pomodoro timer + distraction blocking'
        'metrics:Productivity statistics'
        'template:Project scaffolding'
        'container:Docker/Podman management'
        'remote:SSH + remote development'
        'backup:Project backup with encryption'
    )

    supervision_tools=(
        'observe:Real-time TUI dashboard'
        'gates:Configurable approval checkpoints'
        'journal:Narrative reconstruction'
    )

    meta_commands=(
        'status:Show status of all Daedalos services'
        'doctor:Verify installation and diagnose issues'
        'tools:List all tools with installation status'
        'version:Show version information'
        'help:Show help'
    )

    _arguments -C \
        '1: :->command' \
        '*:: :->args'

    case $state in
        command)
            _describe -t core 'Core Tools' core_tools
            _describe -t human 'Human Tools' human_tools
            _describe -t supervision 'Supervision' supervision_tools
            _describe -t meta 'Meta Commands' meta_commands
            ;;
        args)
            case $words[1] in
                loop)
                    local -a loop_cmds
                    loop_cmds=(
                        'start:Start a new loop'
                        'status:Show loop status'
                        'watch:Watch loop execution live'
                        'pause:Pause a running loop'
                        'resume:Resume a paused loop'
                        'cancel:Cancel a loop'
                        'inject:Inject context into loop'
                        'checkpoint:Create named checkpoint'
                        'rollback:Rollback to checkpoint'
                        'history:Show iteration history'
                        'list:List all loops'
                        'template:Manage loop templates'
                        'workflow:Run multi-loop workflow'
                        'help:Show help'
                    )
                    _describe 'loop command' loop_cmds
                    ;;
                verify)
                    _arguments \
                        '--quick[Run only fast checks]' \
                        '--path[Path to verify]:path:_files -/'
                    ;;
                undo)
                    local -a undo_cmds
                    undo_cmds=(
                        'checkpoint:Create a named checkpoint'
                        'last:Undo the last file change'
                        'timeline:Show timeline of changes'
                        'to:Restore to a checkpoint'
                        'restore:Restore to a checkpoint'
                        'help:Show help'
                    )
                    _describe 'undo command' undo_cmds
                    ;;
                sandbox)
                    local -a sandbox_cmds
                    sandbox_cmds=(
                        'create:Create a new sandbox'
                        'list:List all sandboxes'
                        'enter:Enter a sandbox'
                        'diff:Show changes in sandbox'
                        'promote:Apply sandbox changes to source'
                        'discard:Delete a sandbox'
                        'info:Show sandbox details'
                        'run:Run command in sandbox'
                        'help:Show help'
                    )
                    _describe 'sandbox command' sandbox_cmds
                    ;;
                project)
                    local -a project_cmds
                    project_cmds=(
                        'summary:Project overview'
                        'tree:File tree structure'
                        'search:Search symbols'
                        'deps:Show dependencies'
                        'conventions:Show coding conventions'
                        'help:Show help'
                    )
                    _describe 'project command' project_cmds
                    ;;
                codex)
                    local -a codex_cmds
                    codex_cmds=(
                        'search:Semantic code search'
                        'index:Rebuild search index'
                        'status:Show index status'
                        'help:Show help'
                    )
                    _describe 'codex command' codex_cmds
                    ;;
                context)
                    local -a context_cmds
                    context_cmds=(
                        'estimate:Estimate context usage'
                        'breakdown:Detailed breakdown'
                        'help:Show help'
                    )
                    _describe 'context command' context_cmds
                    ;;
                error-db)
                    local -a errordb_cmds
                    errordb_cmds=(
                        'match:Find solutions for an error'
                        'add:Add new error pattern'
                        'list:List error patterns'
                        'search:Search patterns'
                        'help:Show help'
                    )
                    _describe 'error-db command' errordb_cmds
                    ;;
                agent)
                    local -a agent_cmds
                    agent_cmds=(
                        'spawn:Spawn a new agent'
                        'list:List running agents'
                        'focus:Switch to an agent'
                        'kill:Kill an agent'
                        'search:Search agent outputs'
                        'send:Send message to agent'
                        'inbox:Check agent inbox'
                        'broadcast:Broadcast to all agents'
                        'signal:Completion signals'
                        'lock:Resource locks'
                        'claim:Task claims'
                        'workflow:Multi-agent workflows'
                        'snapshot:Save agent state'
                        'restore:Restore agent state'
                        'request-help:Ask for help from another agent'
                        'help:Show help'
                    )
                    _describe 'agent command' agent_cmds
                    ;;
                mcp-hub)
                    local -a mcphub_cmds
                    mcphub_cmds=(
                        'status:Hub status'
                        'warm:Pre-start servers'
                        'list:List available servers'
                        'restart:Restart a server'
                        'logs:View server logs'
                        'call:Call a tool'
                        'help:Show help'
                    )
                    _describe 'mcp-hub command' mcphub_cmds
                    ;;
                lsp-pool)
                    local -a lsppool_cmds
                    lsppool_cmds=(
                        'status:Pool status'
                        'warm:Pre-warm a language server'
                        'cool:Stop language servers'
                        'list:List running servers'
                        'query:Send LSP query'
                        'languages:List supported languages'
                        'logs:View server logs'
                        'restart:Restart a server'
                        'help:Show help'
                    )
                    _describe 'lsp-pool command' lsppool_cmds
                    ;;
                scratch)
                    local -a scratch_cmds
                    scratch_cmds=(
                        'new:Create scratch environment'
                        'list:List scratch environments'
                        'destroy:Destroy scratch environment'
                        'enter:Enter scratch environment'
                        'help:Show help'
                    )
                    _describe 'scratch command' scratch_cmds
                    ;;
                observe)
                    _arguments \
                        '--help[Show help]' \
                        '--version[Show version]'
                    ;;
                gates)
                    local -a gates_cmds
                    gates_cmds=(
                        'check:Check if action allowed'
                        'level:Get/set supervision level'
                        'set:Set gate action'
                        'config:Show configuration'
                        'history:Show gate history'
                        'help:Show help'
                    )
                    _describe 'gates command' gates_cmds
                    ;;
                journal)
                    local -a journal_cmds
                    journal_cmds=(
                        'what:Narrative of recent events'
                        'events:List raw events'
                        'summary:Event summary'
                        'log:Log custom event'
                        'help:Show help'
                    )
                    _describe 'journal command' journal_cmds
                    ;;
                spec)
                    local -a spec_cmds
                    spec_cmds=(
                        'show:Display a component spec'
                        'query:Search across all specs'
                        'list:List all specs'
                        'context:Get relevant specs for a task'
                        'validate:Validate spec format'
                        'new:Create new spec from template'
                        'help:Show help'
                    )
                    _describe 'spec command' spec_cmds
                    ;;
                resolve)
                    local -a resolve_cmds
                    resolve_cmds=(
                        'intent:Analyze question intent'
                        'gather:Gather context for question'
                        'log:Log a decision'
                        'help:Show help'
                    )
                    _describe 'resolve command' resolve_cmds
                    ;;
                evolve)
                    local -a evolve_cmds
                    evolve_cmds=(
                        'intent:Extract code intent'
                        'gaps:Identify missing features'
                        'path:Get evolution path'
                        'help:Show help'
                    )
                    _describe 'evolve command' evolve_cmds
                    ;;
                env)
                    local -a env_cmds
                    env_cmds=(
                        'enter:Activate project environment'
                        'leave:Deactivate environment'
                        'list:List environments'
                        'current:Show current environment'
                        'help:Show help'
                    )
                    _describe 'env command' env_cmds
                    ;;
                secrets)
                    local -a secrets_cmds
                    secrets_cmds=(
                        'get:Get a secret'
                        'set:Set a secret'
                        'delete:Delete a secret'
                        'list:List secrets'
                        'inject:Inject secrets into env'
                        'init:Initialize vault'
                        'help:Show help'
                    )
                    _describe 'secrets command' secrets_cmds
                    ;;
                focus)
                    local -a focus_cmds
                    focus_cmds=(
                        'start:Start focus session'
                        'stop:Stop focus session'
                        'status:Show status'
                        'config:Configuration'
                        'help:Show help'
                    )
                    _describe 'focus command' focus_cmds
                    ;;
                metrics)
                    local -a metrics_cmds
                    metrics_cmds=(
                        'show:Show metrics'
                        'today:Today stats'
                        'week:This week stats'
                        'month:This month stats'
                        'export:Export data'
                        'help:Show help'
                    )
                    _describe 'metrics command' metrics_cmds
                    ;;
                template)
                    local -a template_cmds
                    template_cmds=(
                        'list:List templates'
                        'show:Show template details'
                        'create:Create from template'
                        'apply:Apply template'
                        'help:Show help'
                    )
                    _describe 'template command' template_cmds
                    ;;
                container)
                    local -a container_cmds
                    container_cmds=(
                        'run:Run container'
                        'build:Build image'
                        'list:List containers'
                        'stop:Stop container'
                        'rm:Remove container'
                        'logs:View logs'
                        'exec:Execute command'
                        'help:Show help'
                    )
                    _describe 'container command' container_cmds
                    ;;
                remote)
                    local -a remote_cmds
                    remote_cmds=(
                        'connect:Connect to remote'
                        'list:List remotes'
                        'add:Add remote'
                        'remove:Remove remote'
                        'sync:Sync files'
                        'help:Show help'
                    )
                    _describe 'remote command' remote_cmds
                    ;;
                backup)
                    local -a backup_cmds
                    backup_cmds=(
                        'create:Create backup'
                        'restore:Restore from backup'
                        'list:List backups'
                        'delete:Delete backup'
                        'verify:Verify backup integrity'
                        'help:Show help'
                    )
                    _describe 'backup command' backup_cmds
                    ;;
            esac
            ;;
    esac
}

_daedalos "$@"
