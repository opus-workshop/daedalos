================================================================================
                            MCP-HUB - SPECIFICATION
                         Model Context Protocol Server Hub
================================================================================

VERSION: 1.0.0
LICENSE: MIT
AUTHOR: Claude (Opus)
STATUS: Reference Specification

================================================================================
                                 PHILOSOPHY
================================================================================

"One hub. Every tool. Zero friction."

MCP (Model Context Protocol) servers extend AI agent capabilities with tools,
resources, and prompts. MCP-Hub is a central manager that:

  1. Discovers and catalogs available MCP servers
  2. Manages server lifecycles (start/stop/restart)
  3. Routes requests to appropriate servers
  4. Handles authentication and configuration
  5. Provides a unified interface for all MCP tools

Instead of manually configuring each MCP server per project, mcp-hub manages
them system-wide with per-project overrides.

================================================================================
                               CORE CONCEPTS
================================================================================

SERVER REGISTRY
---------------
A catalog of known MCP servers with their capabilities, requirements, and
configuration. Includes official servers and community contributions.

SERVER POOL
-----------
Running servers managed by the hub. Servers are started on-demand and kept
warm for fast response times.

TOOL ROUTING
------------
When an agent requests a tool, the hub determines which server provides it
and routes the request appropriately.

CAPABILITY DISCOVERY
--------------------
Agents can query the hub for available tools, resources, and prompts across
all registered servers.

================================================================================
                              COMMAND INTERFACE
================================================================================

mcp-hub start
-------------
Start the MCP hub daemon.

Options:
  --port <port>       Listen port (default: 7776)
  --socket <path>     Unix socket path (default: /run/daedalos/mcp-hub.sock)
  --config <path>     Config file path

The hub daemon:
  - Listens for MCP requests
  - Manages server pool
  - Routes requests to servers
  - Handles authentication

mcp-hub stop
------------
Stop the hub daemon gracefully.

mcp-hub status
--------------
Show hub status and running servers.

Output:
  MCP Hub Status: running
  Port: 7776
  Socket: /run/daedalos/mcp-hub.sock

  Running Servers:
  NAME                 PID      TOOLS    RESOURCES    UPTIME
  filesystem           12345    8        0            2h 15m
  github               12346    15       3            1h 30m
  postgres             12347    12       5            45m

  Idle Servers (available):
  NAME                 TOOLS    LAST USED
  slack                6        3 days ago
  linear               10       1 week ago

mcp-hub list
------------
List all registered servers (running or not).

Output:
  NAME                 STATUS      TOOLS    CATEGORY
  filesystem           running     8        core
  github               running     15       integrations
  postgres             running     12       databases
  memory               available   4        core
  brave-search         available   2        search
  slack                available   6        communication
  puppeteer            available   8        browser

Options:
  --category <cat>    Filter by category
  --capability <cap>  Filter by capability (tools|resources|prompts)
  --json              Output as JSON

mcp-hub search <query>
----------------------
Search for servers by name, tool, or description.

Examples:
  mcp-hub search "github"
  mcp-hub search "file read"
  mcp-hub search "database query"

mcp-hub install <server>
------------------------
Install a new MCP server from the registry.

Arguments:
  <server>            Server name or URL

Sources:
  - Official registry (mcp://registry/name)
  - npm (npm:@package/name)
  - GitHub (github:user/repo)
  - Local path (/path/to/server)

Options:
  --global            Install system-wide (default)
  --project           Install for current project only

Examples:
  mcp-hub install filesystem
  mcp-hub install github:anthropics/mcp-server-github
  mcp-hub install npm:@modelcontextprotocol/server-postgres

mcp-hub uninstall <server>
--------------------------
Remove an installed server.

mcp-hub update [server]
-----------------------
Update server(s) to latest version.

Arguments:
  [server]            Server to update (all if omitted)

mcp-hub enable <server>
-----------------------
Enable a server to be started by the hub.

mcp-hub disable <server>
------------------------
Disable a server (won't be auto-started).

mcp-hub config <server> [--set KEY=VALUE]
-----------------------------------------
View or modify server configuration.

Examples:
  mcp-hub config github                    # View config
  mcp-hub config github --set token=xxx    # Set token
  mcp-hub config postgres --set host=localhost

mcp-hub tools [server]
----------------------
List available tools, optionally from a specific server.

Output:
  SERVER              TOOL                         DESCRIPTION
  filesystem          read_file                    Read a file from the filesystem
  filesystem          write_file                   Write content to a file
  filesystem          list_directory               List directory contents
  github              create_issue                 Create a GitHub issue
  github              create_pull_request          Create a pull request
  postgres            query                        Execute SQL query

Options:
  --json              Output as JSON

mcp-hub resources [server]
--------------------------
List available resources.

mcp-hub prompts [server]
------------------------
List available prompt templates.

mcp-hub call <tool> [args...]
-----------------------------
Directly call an MCP tool from the command line.

Examples:
  mcp-hub call read_file --path /etc/hostname
  mcp-hub call github.create_issue --repo user/repo --title "Bug"
  mcp-hub call postgres.query --sql "SELECT * FROM users"

Options:
  --server <name>     Force use of specific server
  --json-args <json>  Pass arguments as JSON
  --raw               Output raw result without formatting

mcp-hub logs [server]
---------------------
View server logs.

Options:
  --follow, -f        Follow log output
  --lines, -n <num>   Number of lines to show

mcp-hub restart <server>
------------------------
Restart a specific server.

mcp-hub warm <servers...>
-------------------------
Pre-start servers to ensure fast response.

Examples:
  mcp-hub warm filesystem github postgres

================================================================================
                              CONFIGURATION
================================================================================

System configuration: ~/.config/daedalos/mcp-hub/config.yaml

```yaml
# MCP Hub Configuration

hub:
  port: 7776
  socket: /run/daedalos/mcp-hub.sock
  log_level: info

pool:
  max_idle_servers: 5
  idle_timeout: 30m
  startup_timeout: 10s

servers:
  filesystem:
    enabled: true
    auto_start: true
    command: npx @modelcontextprotocol/server-filesystem
    args: ["/"]

  github:
    enabled: true
    auto_start: false
    command: npx @modelcontextprotocol/server-github
    env:
      GITHUB_TOKEN: ${GITHUB_TOKEN}

  postgres:
    enabled: true
    auto_start: false
    command: npx @modelcontextprotocol/server-postgres
    config:
      host: localhost
      port: 5432
      database: mydb

# Project-specific overrides are in .daedalos/mcp.yaml
```

Project configuration: .daedalos/mcp.yaml

```yaml
# Project-specific MCP configuration

servers:
  postgres:
    config:
      database: project_db

  custom-server:
    command: python ./tools/mcp_server.py
    auto_start: true
```

================================================================================
                         INTEGRATION WITH AGENTS
================================================================================

Agents connect to mcp-hub instead of individual servers:

1. Agent starts, connects to mcp-hub
2. Hub provides unified capability list
3. Agent requests tool â†’ hub routes to appropriate server
4. Hub starts server if needed (on-demand)
5. Result returned to agent

For FOSS agents (OpenCode, Aider):
  - Configure MCP endpoint as mcp-hub address
  - Hub handles all the complexity

For Claude Code:
  - mcp-hub can proxy requests
  - Or use Claude's native MCP with hub as server

================================================================================
                              SERVER REGISTRY
================================================================================

The hub maintains a registry of known MCP servers:

Official servers (auto-updated):
  - filesystem
  - github
  - postgres
  - sqlite
  - brave-search
  - puppeteer
  - memory
  - slack

Community servers (curated):
  - linear
  - notion
  - jira
  - aws
  - docker

Local servers:
  - Discovered from project .daedalos/mcp.yaml
  - Custom servers in ~/.config/daedalos/mcp-hub/servers/

================================================================================
                            AUTHENTICATION
================================================================================

Servers requiring authentication store credentials in:
  - Environment variables (recommended)
  - System keyring (libsecret)
  - Encrypted config (with master password)

mcp-hub auth <server>
---------------------
Set up authentication for a server.

Examples:
  mcp-hub auth github    # Interactive setup
  mcp-hub auth github --token <token>

================================================================================
                              EXIT CODES
================================================================================

0   Success
1   General error
2   Server not found
3   Tool not found
4   Authentication required
5   Server failed to start
6   Hub not running

================================================================================
                           IMPLEMENTATION NOTES
================================================================================

Language: Python (for MCP SDK compatibility)

Dependencies:
  - Python 3.10+
  - mcp SDK
  - aiohttp (async HTTP)
  - pyyaml
  - click (CLI)
  - keyring (secrets)

Architecture:
  - Async event loop for handling multiple servers
  - Server processes managed via subprocess
  - Unix socket + HTTP for communication
  - SQLite for server registry and state

================================================================================
